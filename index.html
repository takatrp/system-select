<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>FXクラウドシリーズ 導入診断チャート</title>
  <meta name="description" content="貴社に最適なFXクラウドシリーズの構成を、YES／NOで簡単に診断できるチェックツールです。">

  <style>
    :root{
      --bg:#f4f9fb;
      --card:#ffffff;
      --ink:#1e2a2d;
      --muted:#5a6a6d;
      --accent:#578899;
      --accent-dark:#476a7c;
      --accent-soft:rgba(87,136,153,.08);
      --border:#dde5ea;
      --highlight-bg:#eef6f9;
    }

    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",sans-serif;
      background:var(--bg);
      color:var(--ink);
    }

    .app{
      max-width:900px;
      margin:0 auto;
      padding:24px 16px 40px;
    }

    h1{
      font-size:1.6rem;
      margin:0 0 .3rem;
      color: var(--accent-dark);
    }

    p{
      line-height:1.7;
      margin:.25rem 0 .5rem;
    }

    .intro-text {
      color: var(--ink);
      margin-bottom: 20px;
    }

    .progress{
      margin:16px 0 20px;
      height:8px;
      border-radius:999px;
      background:#dde5ea;
      overflow:hidden;
    }

    .progress-bar{
      height:100%;
      width:0%;
      background:var(--accent);
      transition:width .25s ease;
    }

    /* --- カードデザイン --- */
    .question-card{
      background:var(--card);
      border-radius:12px;
      box-shadow:0 4px 18px rgba(0,0,0,.05);
      padding:20px 24px;
      display:flex;
      flex-direction:column;
      height:620px; 
      position: relative;
    }

    .q-header-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:10px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 8px;
    }

    .q-number{
      font-size:.85rem;
      color:var(--muted);
      font-weight: bold;
    }

    .q-title-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .q-title{
      font-weight:600;
      font-size:0.9rem; 
      color: var(--muted);
      margin:0;
    }

    .q-category{
      display:inline-block;
      font-size:.75rem;
      padding:2px 8px;
      border-radius:4px;
      background:var(--accent-soft);
      color:var(--accent-dark);
      font-weight: 600;
    }

    .q-main{
      flex:1;
      overflow-y:auto;
      padding-right:4px;
      display: flex;
      flex-direction: column;
    }

    /* --- 画像スタイル --- */
    .q-image-container {
      width: 100%;
      height: 160px;
      margin-bottom: 12px;
      border-radius: 8px;
      overflow: hidden;
      background-color: var(--highlight-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .q-image-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .q-text{
      margin:4px 0 12px;
      line-height:1.5;
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--ink);
    }

    .q-example{
      font-size:.85rem;
      color:var(--muted);
      background: #f8f9fa;
      padding: 8px 12px;
      border-radius: 6px;
      margin-bottom: 6px; 
      line-height:1.5;
      border-left: 3px solid #cbd5e1;
    }

    .point-wrapper {
      margin-top: 6px; 
    }

    .point-label{
      font-size:.75rem;
      font-weight:700;
      color:var(--accent);
      letter-spacing:.05em;
      margin-bottom: 2px;
    }

    .point-box{
      font-size:.9rem;
      line-height:1.6;
      color: var(--ink);
    }

    .btn-back{
      background:transparent;
      color:var(--muted);
      border:1px solid transparent;
      border-radius:999px;
      padding:4px 0;
      font-size:.9rem;
      cursor:pointer;
      white-space:nowrap;
    }
    .btn-back:hover{
      text-decoration:underline;
    }

    /* --- ボタンエリア --- */
    .btn-row{
      flex:0 0 auto;
      margin-top:auto;
      padding-top: 16px;
      border-top: 1px solid var(--border);
      display:flex;
      justify-content:flex-end;
      gap:16px;
    }

    button{
      border-radius:999px;
      border:1px solid transparent;
      padding:10px 24px;
      font-size:1rem;
      font-weight: 600;
      cursor:pointer;
      font-family:inherit;
      background:#fff;
      transition:all .2s ease;
    }

    button:active{
      transform:translateY(2px);
    }

    .btn-yes{
      background:var(--accent);
      color:#fff;
      box-shadow: 0 4px 10px rgba(87,136,153,0.3);
    }
    .btn-yes:hover{
      background:var(--accent-dark);
      box-shadow: 0 6px 14px rgba(87,136,153,0.4);
    }

    .btn-no{
      background:#fff;
      color:var(--accent);
      border: 1px solid var(--accent);
    }
    .btn-no:hover{
      background:var(--accent-soft);
    }

    /* --- 結果画面アクション --- */
    .result-actions {
      display: flex;
      justify-content: space-between;
      margin-bottom: 16px;
      gap: 12px;
    }

    .btn-again, .btn-print {
      font-size:.9rem;
      padding: 8px 16px;
      border-radius: 999px;
      cursor: pointer;
      font-weight: 600;
    }

    .btn-again {
      background:#fff;
      color:var(--muted);
      border:1px solid var(--border);
    }
    .btn-again:hover {
      background:#f8f9fa;
      color: var(--ink);
    }

    .btn-print {
      background: #fff;
      color: var(--accent-dark);
      border: 1px solid var(--accent);
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .btn-print:hover {
      background: var(--highlight-bg);
    }

    /* --- 結果画面デザイン --- */
    .result{
      display:none;
      margin-top:12px;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .result-card {
      height: auto; 
    }

    .result h2{
      margin-top:0;
      margin-bottom:.5rem;
      font-size: 1.4rem;
      color: var(--accent-dark);
      border-bottom: 2px solid var(--accent-soft);
      padding-bottom: 8px;
    }

    .badge{
      display:inline-block;
      padding:4px 12px;
      font-size:.9rem;
      font-weight: bold;
      border-radius:999px;
      background:var(--accent-soft);
      color:var(--accent-dark);
    }

    .recommend-box {
      text-align: center;
      background: linear-gradient(135deg, #ffffff 0%, #f4f9fb 100%);
      border: 2px solid var(--accent);
      border-radius: 12px;
      padding: 24px;
      margin: 20px 0;
      box-shadow: 0 8px 24px rgba(87, 136, 153, 0.15);
      page-break-inside: avoid;
    }

    .recommend-label {
      font-size: 0.9rem;
      color: var(--muted);
      margin-bottom: 8px;
      display: block;
      font-weight: bold;
    }

    .recommend-name {
      display: block;
      font-size: 2.2rem;
      font-weight: 800;
      color: var(--accent-dark);
      letter-spacing: 0.05em;
      line-height: 1.2;
      margin-bottom: 16px;
    }

    .recommend-link {
      display: inline-block;
      text-decoration: none;
      background: var(--accent-dark);
      color: #fff;
      padding: 8px 24px;
      border-radius: 999px;
      font-size: 0.95rem;
      font-weight: bold;
      transition: background 0.2s;
    }
    .recommend-link:hover {
      background: var(--accent);
    }
    .recommend-link::after {
      content: " >";
      margin-left: 6px;
    }

    .summary-grid{
      display:grid;
      grid-template-columns:minmax(0,2fr) minmax(0,3fr);
      gap:24px;
      margin-top:24px;
      align-items:flex-start;
      border-top: 1px solid var(--border);
      padding-top: 24px;
    }

    @media (max-width:720px){
      .summary-grid{
        grid-template-columns:1fr;
      }
      .question-card {
        height: 680px; 
        padding: 16px;
      }
      .q-text {
        font-size: 1.2rem;
      }
      .recommend-name {
        font-size: 1.8rem;
      }
    }

    .summary-grid h3{
      margin:0 0 12px;
      font-size:1.1rem;
      color: var(--accent-dark);
    }

    .summary-grid ul{
      margin:0;
      padding:0 0 0 1.2rem;
      font-size:.95rem;
      color: var(--ink);
    }
    .summary-grid li {
      margin-bottom: 6px;
    }

    .answers-table{
      width:100%;
      border-collapse:collapse;
      font-size:.9rem;
      margin-top:24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.03);
    }

    .answers-table th,
    .answers-table td{
      border:1px solid var(--border);
      padding:10px 12px;
      vertical-align:top;
    }

    .answers-table th{
      background:#f3f6f8;
      text-align:left;
      font-weight:600;
      color: var(--accent-dark);
      white-space: nowrap;
    }

    .answer-yes{
      color:#00695c;
      font-weight:bold;
      background: rgba(0, 105, 92, 0.05);
      text-align: center;
    }

    .answer-no{
      color:#b71c1c;
      font-weight:bold;
      text-align: center;
    }

    .note{
      margin-top:20px;
      padding: 16px;
      background: #fafafa;
      border-radius: 8px;
      font-size:.8rem;
      color:var(--muted);
      line-height:1.6;
    }

    /* グラフコンテナ：重要 */
    .chart-container {
      position: relative;
      width: 100%;
      height: 300px;
    }

    /* --- 印刷用スタイル --- */
    @media print {
      body { background: #fff; color: #000; -webkit-print-color-adjust: exact; print-color-adjust: exact;}
      .app { max-width: 100%; margin: 0; padding: 0; }
      .progress, .btn-row, .btn-back, .result-actions, .recommend-link { display: none !important; }
      .question-card { box-shadow: none; border: none; padding: 0; height: auto; }
      .recommend-box { border: 1px solid #000; box-shadow: none; background: #fff; }
      .answers-table th { background: #eee !important; color: #000; }
      .answer-yes { color: #000; font-weight: bold; }
      .answer-no { color: #666; }
      h1 { font-size: 1.4rem; color: #000; }
      p, li, td { color: #000; }
      .note { border: 1px solid #ddd; background: #fff; color: #444; }
    }
  </style>
</head>
<body>
<div class="app">
  <h1>FXクラウドシリーズ 導入診断チャート</h1>
  <p class="intro-text">
    貴社の経理体制やご要望について、YES／NOを選ぶだけで最適な「FXクラウドシリーズ」の構成をご提案します。
  </p>

  <div class="progress">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <div id="questionArea" class="question-card"></div>

  <div id="resultArea" class="result"></div>
</div>

<!-- グラフ用ライブラリ（横棒グラフ） -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  // 設問データ
  const questions = [
    {
      id: "accountsStructure",
      title: "１．勘定科目体系",
      category: "会計・管理会計",
      question: "勘定科目（売上高、仕入高、販管費等）を自由に設計したいですか？",
      point: "財務三表科目とは異なる勘定科目（コード）での設計および追加、並べ替えができます。また、複数の科目残高を合算する「小計科目」の登録、貸借対照表科目の部門別残高管理もできます。",
      example: "例:売上・仕入科目数を4つ以上設定する",
      image: "https://placehold.co/600x200/eef3f6/578899?text=Account+Structure"
    },
    {
      id: "subAccount",
      title: "２．同一科目の取引先別、口座別管理併用",
      category: "会計・管理会計",
      question: "勘定科目ごとに複数（口座別・取引先別等）の残高管理がしたいですか？",
      point: "１つの勘定科目に対して取引先別＋口座別等の併用管理ができます。例えば、預り金を取引先（社員A〜、取引先A〜）＋口座別（源泉所得税、社会保険料等）のような運用が可能です。",
      example: "例:各月の売上を取引先毎と商品カテゴリー毎を同時に残高管理する",
      image: "https://placehold.co/600x200/eef3f6/578899?text=Multi+Balance+Check"
    },
    {
      id: "deptPerformance",
      title: "３．部門業績管理",
      category: "部門管理",
      question: "部門を階層別・グループ別に管理したいですか？",
      point: "部門階層構造を多段階で設計できます。また、部門階層とは異なる視点での部門業績を確認するための部門グループ設計もできます。",
      example: "例:地域毎・店舗毎・担当者毎の業績管理<br>債権債務の取引先別残高を部門ごとに管理、本支店会計を部門で行う",
      image: "https://placehold.co/600x200/eef3f6/578899?text=Department+Management"
    },
    {
      id: "deptPermission",
      title: "４．部門参照（入力）権限",
      category: "部門管理・統制",
      question: "経理担当者ごとに参照可能部門を制限したいですか？",
      point: "経理担当者ごとに特定の部門のみ入力・業績閲覧を可とする参照権限を設定できます。また、経理担当者ごとに利用可能なメニューの制限もできます。",
      example: "例:自部門のデータのみ閲覧・入力できるように制限する",
      image: "https://placehold.co/600x200/eef3f6/578899?text=Access+Control"
    },
    {
      id: "voucherWorkflow",
      title: "５．証憑保存",
      category: "証憑保存・内部統制",
      question: "証憑保存機能を経理担当以外でも利用したいですか？",
      point: "オプション「インボイス・マネジャー（FX4クラウド）」は、FX4クラウド未登録のパソコンから証憑を保存できます。また、多段階承認機能を活用した経費申請〜上長の承認〜経理担当の承認〜保存＆仕訳計上もできます。",
      example: "例:各部門や支店のパソコンから証憑を保存する",
      image: "https://placehold.co/600x200/eef3f6/578899?text=Voucher+Storage"
    },
    {
      id: "excelJournal",
      title: "６．Excelからの仕訳計上",
      category: "仕訳自動化",
      question: "Excel集計表等から仕訳を計上したいですか？",
      point: "Excel作成の日報や出納帳からFX4クラウドを起動させることなく仕訳を計上できます。また、MR設計ツールと併用した運用（部門共通費の部門配賦等）もできます。",
      example: "例:企業がExcelで作成している日報や出納帳から仕訳を計上する",
      image: "https://placehold.co/600x200/eef3f6/578899?text=Excel+Import"
    },
    {
      id: "systemJournal",
      title: "７．業務システムデータからの仕訳計上",
      category: "仕訳自動化",
      question: "業務システムのデータから仕訳を計上したいですか？",
      point: "仕訳読込テンプレート設計機能により、業務システムの出力データを加工することなく仕訳を計上できます。細かな単位の仕訳を手間なく計上することで、FX4クラウドを活用した詳細な財務分析が可能です。",
      example: "例:販売管理システムの出力データから売上・入金仕訳を計上する",
      image: "https://placehold.co/600x200/eef3f6/578899?text=System+Linkage"
    },
    {
      id: "groupManagement",
      title: "８．企業グループ業績管理",
      category: "グループ管理",
      question: "グループ会社全体の業績を一元管理したいですか？",
      point: "グループ会社でFX4クラウドを利用することで、内部取引を相殺したグループ業績管理ができます。また、仕訳入力や証憑保存方法など、グループ全体の経理処理を統一することもできます。",
      example: "例:グループ全体業績をタイムリーかつ効率的に管理する",
      image: "https://placehold.co/600x200/eef3f6/578899?text=Group+Management"
    },
    {
      id: "ipoControl",
      title: "９．株式上場",
      category: "内部統制・IPO",
      question: "株式上場（IPO）している、または視野に入れていますか？",
      point: "IT全般統制・IT業務処理統制の対応等により、内部統制等への対応が求められる上場企業でも利用いただけます。なお、「受託業務に係る内部統制の保証報告書」（3402監査報告書）を無償で提供しています。",
      example: "",
      image: "https://placehold.co/600x200/eef3f6/578899?text=IPO+Support"
    },
    {
      id: "deptPermissionFx2",
      title: "１０．部門参照（入力）権限（FX2等）",
      category: "部門管理・統制",
      question: "部門業績を管理したい、または利用メニューを制限したいですか？",
      point: "部門別（多段階で登録する場合はFX4クラウド）での業績管理ができます。また、経理担当者ごとに利用可能なメニューの制限もできます。",
      example: "※部門別の業績管理が可能です。",
      image: "https://placehold.co/600x200/eef3f6/578899?text=Dept+Management"
    },
    {
      id: "payManagement",
      title: "１１．支払管理機能",
      category: "オプション：支払管理",
      question: "支払をシステムで管理したい、または支払データの作成まで行いたいですか？",
      point: "売掛金の回収、買掛金の支払い、借入金の返済、手形の決済予定等の様々な入金・支払予定を網羅した「資金繰り計画用」を作成できます。",
      example: "例:仕入仕訳を元に支払予定をカレンダー形式で管理、銀行振込データを作成",
      image: "https://placehold.co/600x200/eef3f6/578899?text=Payment+Management"
    },
    {
      id: "payroll",
      title: "１２．給与計算機能",
      category: "オプション：給与計算",
      question: "給与計算をする社員数が30人以上、または複数事業所ですか？",
      point: "経営者による賃金の適正な配分の決定と給与事務の合理化を支援します。",
      example: "※FXまいスタークラウドの場合、30人までしか給与計算が行えません。",
      image: "https://placehold.co/600x200/eef3f6/578899?text=Payroll+System"
    },
    {
      id: "reportDesign",
      title: "１３．MR設計ツール",
      category: "オプション：帳票設計・経営資料",
      question: "科目残高を反映した経営管理用レポートを独自に作成していますか？",
      point: "マネジメントレポート（MR）設計ツールにより、FXクラウドシリーズのデータを活用したオリジナル帳表がExcelで簡単に作成できます。",
      example: "例:ExcelからFXクラウドシリーズのデータにアクセスし、データを自動で取得",
      image: "https://placehold.co/600x200/eef3f6/578899?text=Report+Design"
    }
  ];

  const answers = {};
  let currentIndex = 0;
  let categoryChartInstance = null;

  function updateProgress() {
    const bar = document.getElementById("progressBar");
    const total = questions.length;
    const ratio = Math.min(currentIndex, total) / total;
    bar.style.width = (ratio * 100) + "%";
  }

  function renderQuestion() {
    const total = questions.length;
    const q = questions[currentIndex];
    const area = document.getElementById("questionArea");
    const resultArea = document.getElementById("resultArea");

    area.style.display = "flex"; 
    resultArea.style.display = "none";

    updateProgress();

    // 画像があれば表示する
    const imageHtml = q.image 
      ? `<div class="q-image-container"><img src="${q.image}" alt="${q.title}のイメージ"></div>`
      : "";

    area.innerHTML = `
      <div class="q-header-row">
        <div>
          ${currentIndex > 0 ? '<button type="button" class="btn-back" id="backBtn">← 戻る</button>' : ""}
        </div>
        <div style="text-align:right;">
          <div class="q-number">Q. ${currentIndex + 1} / ${total}</div>
        </div>
      </div>
      
      <div class="q-main">
        <div class="q-title-row">
          <span class="q-category">${q.category}</span>
          <span class="q-title">${q.title}</span>
        </div>

        ${imageHtml}

        <div class="q-text">${q.question}</div>
        
        ${q.example ? `<div class="q-example">${q.example}</div>` : ""}
        
        <div class="point-wrapper">
          <div class="point-label">POINT</div>
          <div class="point-box">${q.point}</div>
        </div>
      </div>

      <div class="btn-row">
        <button type="button" class="btn-no" data-answer="no">NO</button>
        <button type="button" class="btn-yes" data-answer="yes">YES</button>
      </div>
    `;

    // YES/NO Logic
    area.querySelectorAll("[data-answer]").forEach(btn => {
      btn.addEventListener("click", () => {
        const answer = btn.getAttribute("data-answer");
        answers[q.id] = answer;
        currentIndex++;
        if (currentIndex < total) {
          renderQuestion();
        } else {
          showResult();
        }
      });
    });

    // 戻るボタン
    const backBtn = area.querySelector("#backBtn");
    if (backBtn) {
      backBtn.addEventListener("click", () => {
        currentIndex = Math.max(0, currentIndex - 1);
        renderQuestion();
      });
    }
  }

  function createCategoryBarChart(categoryStats) {
    // グラフを描画するcanvas要素を取得
    const canvas = document.getElementById("categoryBar");
    if (!canvas || !window.Chart) return;

    const labels = Object.keys(categoryStats);
    const data = labels.map(label => {
      const s = categoryStats[label];
      if (!s || !s.total) return 0;
      return Math.round((s.yes / s.total) * 100);
    });

    const ctx = canvas.getContext("2d");

    if (categoryChartInstance) {
      categoryChartInstance.destroy();
    }

    // Chart.jsの設定
    categoryChartInstance = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: 'YES率',
          data: data,
          borderWidth: 0,
          borderRadius: 4,
          backgroundColor: '#578899',
        }]
      },
      options: {
        indexAxis: 'y', // 横棒グラフ
        responsive: true,
        maintainAspectRatio: false, // コンテナの高さを維持して描画
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: function(context) {
                return context.parsed.x + '%';
              }
            }
          }
        },
        scales: {
          x: {
            suggestedMin: 0,
            suggestedMax: 100,
            ticks: { stepSize: 20 }
          }
        }
      }
    });
  }

  function showResult() {
    const area = document.getElementById("questionArea");
    const resultArea = document.getElementById("resultArea");
    const total = questions.length;
    const yesCount = questions.filter(q => answers[q.id] === "yes").length;

    // 判定ロジック
    const yesFirstBlock = questions.slice(0, 9).some(q => answers[q.id] === "yes");
    const yesSecondBlock = questions.slice(9, 13).some(q => answers[q.id] === "yes");

    let recommendedSystem = "";
    let recommendedNote = "";
    let recommendedUrl = "";
    let level = "";
    let detail = "";

    if (yesFirstBlock) {
      recommendedSystem = "FX4クラウド";
      recommendedUrl = "https://www.tkc.jp/fx4/";
      level = "グループ管理・内部統制まで意識した高度構成";
      detail = "前半の設問（高度管理・統制）でニーズがあるため、FX4クラウドを中核とした構成が望ましいと考えられます。";
      recommendedNote = "部門管理・グループ管理・ワークフローまで含めた包括的な対応が可能です。";
    } else if (yesSecondBlock) {
      recommendedSystem = "FX2クラウド";
      recommendedUrl = "https://www.tkc.jp/fx/";
      level = "管理会計・オプション機能を備えた標準構成";
      detail = "標準的な自計化ニーズに加え、支払管理や給与等の特定オプションが必要な構成です。";
      recommendedNote = "FX2クラウドを中心に、必要に応じて支払管理や給与計算、帳票設計などのオプションを組み合わせる形が推奨されます。";
    } else {
      recommendedSystem = "FXまいスタークラウド";
      recommendedUrl = "https://www.tkc.jp/fx/";
      level = "シンプル自計化構成（小規模向け）";
      detail = "高度な部門管理等は不要なため、まずはシンプルな自計化導入が適しています。";
      recommendedNote = "取引が比較的シンプルで、経理負担を軽減したい場合に適した構成です。";
    }

    // カテゴリ集計
    const categoryStats = {};
    questions.forEach(q => {
      if (!categoryStats[q.category]) {
        categoryStats[q.category] = { yes: 0, total: 0 };
      }
      categoryStats[q.category].total++;
      if (answers[q.id] === "yes") {
        categoryStats[q.category].yes++;
      }
    });

    let categoryHtml = "<ul>";
    Object.entries(categoryStats).forEach(([cat, stat]) => {
      categoryHtml += `<li>${cat}: <strong>${stat.yes}</strong> / ${stat.total}</li>`;
    });
    categoryHtml += "</ul>";

    // 回答一覧生成
    let answersHtml = `
      <table class="answers-table">
        <thead>
          <tr>
            <th>項目</th>
            <th>質問</th>
            <th>回答</th>
            <th>POINT</th>
          </tr>
        </thead>
        <tbody>
    `;
    questions.forEach(q => {
      const a = answers[q.id] || "-";
      const cls = a === "yes" ? "answer-yes" : (a === "no" ? "answer-no" : "");
      const label = a === "yes" ? "YES" : (a === "no" ? "NO" : "-");
      answersHtml += `
        <tr>
          <td>${q.title}</td>
          <td>${q.question}</td>
          <td class="${cls}">${label}</td>
          <td>${q.point}</td>
        </tr>
      `;
    });
    answersHtml += "</tbody></table>";

    document.getElementById("progressBar").style.width = "100%";
    area.style.display = "none";

    resultArea.innerHTML = `
      <div class="question-card result-card">
        <div class="result-actions">
          <button type="button" class="btn-again" id="btnRetry">↺ はじめからやり直す</button>
          <button type="button" class="btn-print" onclick="window.print()">結果を印刷 / PDF保存</button>
        </div>

        <h2>診断結果</h2>
        <p>
          <span class="badge">YES数：${yesCount} / ${total}</span>
        </p>

        <!-- おすすめツール名の強調表示 + リンク -->
        <div class="recommend-box">
          <span class="recommend-label">おすすめのシステム</span>
          <span class="recommend-name">${recommendedSystem}</span>
          <a href="${recommendedUrl}" target="_blank" class="recommend-link">詳しくはこちら</a>
        </div>

        <p style="text-align:center; margin-bottom:20px;">${recommendedNote}</p>

        <div class="summary-grid">
          <div>
            <h3>推奨レベル（全体像）</h3>
            <p><strong>${level}</strong></p>
            <p style="font-size:0.9rem; color:var(--muted);">${detail}</p>

            <h3 style="margin-top:20px;">カテゴリ別の傾向</h3>
            ${categoryHtml}
          </div>

          <div>
            <h3>カテゴリ別 YES比率</h3>
            <!-- 重要：グラフのコンテナ -->
            <div class="chart-container">
              <canvas id="categoryBar"></canvas>
            </div>
          </div>
        </div>

        <h3 style="margin-top:30px; color:var(--accent-dark);">回答詳細一覧</h3>
        ${answersHtml}

        <div class="note">
          ※ この診断結果は簡易的な目安です。実際の導入にあたっては、事業規模や運用体制に合わせて詳細な検討が必要です。<br>
          ※ 詳しくは担当の会計事務所（TKC会員事務所）へご相談ください。
        </div>
      </div>
    `;

    resultArea.style.display = "block";

    // グラフ生成
    createCategoryBarChart(categoryStats);

    const retryBtn = document.getElementById("btnRetry");
    if (retryBtn) {
      retryBtn.addEventListener("click", () => {
        Object.keys(answers).forEach(k => delete answers[k]);
        currentIndex = 0;
        document.getElementById("progressBar").style.width = "0%";
        resultArea.style.display = "none";
        renderQuestion();
      });
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    renderQuestion();
  });
</script>
</body>
</html>


